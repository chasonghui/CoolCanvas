<head>
    <link rel="stylesheet" href="video.css">
</head>

<body>
    <div class="container">
        <video class="video" id="vd1" controls autoPlay loop src="60.mp4" onplay="resize_canvas(this)"></video>
        <div id="readout"></div>
        <canvas class="canvas" id="cv1"></canvas>
        <!-- Video Controls -->
        <div id="vcontrols" class="video-controls">
            <button type="button" id="play-pause">Pause</button>
            <input type="range" id="seek-bar" value="0">
            <button id="clear" onclick="clear_click();">clear</button>
        </div>
    </div>

    <script>
        var canvas = document.getElementById("cv1");
        var video = document.getElementById("vd1");
        var ctx = canvas.getContext("2d");
        var readout = document.getElementById('readout');
        var vcontrols = document.getElementById("vcontrols");
        var seekBar = document.getElementById("seek-bar");
        //비디오 크기
        var w = video.offsetWidth;
        var h = video.offsetHeight;

        //canvas 원점 변환
        ctx.translate(0, -h);

        //클릭시 Canvas좌표 저장할 배열
        var coords = [];


        vcontrols.style.marginTop = h + 100;
        readout.style.marginTop = h + 200;
        seekBar.style.width = w;

        // 캔버스 오버레이(vedio 사이즈에 맞게)
        function resize_canvas(element) {
            var w = element.offsetWidth;
            var h = element.offsetHeight;
            var cv = document.getElementById("cv1");
            cv.width = w;
            cv.height = h;
        }

        //캔버스 좌표--------------------------------------------------
        function windowToCanvas(canvas, x, y) {
            var bbox = canvas.getBoundingClientRect(); //viewport 기준으로 나의 위치 알려줌
            return {
                x: x - bbox.left * (canvas.width / bbox.width),
                y: y - bbox.top * (canvas.height / bbox.height)//y좌표수정
            };
        }



        //바탕 회색줄-----------------------------------------------------------
        function drawBackground() { //바탕에 회색 줄 그리기
            var VERTICAL_LINE_SPACING = 12; //줄 간격
            var i = ctx.canvas.height;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = "lightgray";
            ctx.lineWidth = 0.5;
            while (i > VERTICAL_LINE_SPACING * 4) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(ctx.canvas.width, i);
                ctx.stroke();
                i -= VERTICAL_LINE_SPACING;
            }
        }

        //가이드라인-----------------------------------------------------------
        function drawGuidelines(x, y) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);//초기화 
            ctx.strokeStyle = 'rgba(0, 0, 230, 0.8)';
            ctx.lineWidth = 0.5;
            drawVerticalLine(x);
            drawHorizontalLine(y);
        }

        //mouseon위치의 좌표 출력 
        function updateReadout(x, y) { //div 부분에 좌표 입력(readout)
            readout.innerText = '(' + x.toFixed(0) + ',' + y.toFixed(0) + ')';
            console.log(x, y);
        }

        //clear버튼
        function clear_click() {
            ctx.clearRect(0, 0, canvas.width, canvas.height)
            coords = [];
        }
        //파란선---------------------------------------------------------------
        function drawHorizontalLine(y) { //마우스 있는 곳에 가로 선 그리기(파랑)
            ctx.beginPath();
            ctx.moveTo(0, y + 0.5);
            ctx.lineTo(ctx.canvas.width, y + 0.5);
            ctx.stroke();
        }
        //세로선---------------------------------------------------------------
        function drawVerticalLine(x) {
            ctx.beginPath();
            ctx.moveTo(x + 0.5, 0);
            ctx.lineTo(x + 0.5, ctx.canvas.height);
            ctx.stroke();
        }

        //canvas 좌표 값 -----------------------------------------
        canvas.onmousemove = function (e) { //마우스가 canvas 위에 있을 때 함수 실행

            var loc = windowToCanvas(canvas, e.clientX, e.clientY);
            //e.clientX: 마우스의 x좌표값, e.clicentY: 마우스 y좌표값
            // drawBackground();
            //drawGuidelines(loc.x, loc.y);
            updateReadout(loc.x, loc.y);
        };

        //canvas 좌표 저장(클릭시)

        function storeCoordinate(x, y, array) {
            array.push(x);
            array.push(y);
        }

        //canvas 클릭시 영상 일시정지,재생, 좌표저장----------------------------------------
        canvas.addEventListener('click', function (ev) {
            var video = document.getElementById("vd1");
            var loc = windowToCanvas(canvas, ev.clientX, ev.clientY);
            storeCoordinate(loc.x, loc.y, coords);//클릭한 좌표를 coordes배열에 저장 x:짝수, y:홀수
            ctx.font = 'italic 40px Calibri';
            ctx.fillText('x', loc.x, loc.y);
            console.log(coords);//배열 출력 
            // Buttons
            var playButton = document.getElementById("play-pause");
            if (video.paused == true) {
                // Play the video
                //video.play();
                // Update the button text to 'Pause'
                //playButton.innerHTML = "Pause";
            } else {
                // Pause the video
                //video.pause();

                // Update the button text to 'Play'
                // playButton.innerHTML = "Play ";
            }
        });



        //동영상 컨트롤---------------------------------------------------------
        window.onload = function () {

            // Video
            var video = document.getElementById("vd1");


            var playButton = document.getElementById("play-pause");
            // Sliders

            var volumeBar = document.getElementById("volume-bar");

            // 재생/일시정지 기능
            playButton.addEventListener("click", function () {
                if (video.paused == true) {
                    // Play the video
                    video.play();

                    // Update the button text to 'Pause'
                    playButton.innerHTML = "Pause";
                } else {
                    // Pause the video
                    video.pause();

                    // Update the button text to 'Play'
                    playButton.innerHTML = "Play ";
                }
            });

            // 재생바가 있는 위치로 화면 이동
            seekBar.addEventListener("change", function () {
                // Calculate the new time
                var time = video.duration * (seekBar.value / 100);

                // Update the video time
                video.currentTime = time;
            });


            // 재생시간에 따른 재생바 이동
            video.addEventListener("timeupdate", function () {
                // Calculate the slider value
                var value = (100 / video.duration) * video.currentTime;

                // Update the slider value
                seekBar.value = value;
            });

            // 재생바 드래그하려고 클릭시에 동영상 정지
            seekBar.addEventListener("mousedown", function () {
                video.pause();
            });

        }
    </script>
</body>